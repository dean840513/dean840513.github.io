<html>
<style type="text/css">
body{
	font-family: Arial, Helvetica, sans-serif;
	font-size: 14px;
	color: #333;
}
a:link {
	color: #333;
	text-decoration: none;
}
a:visited {
	color: #333;
	text-decoration: none;
}
a:hover {
	color: #333;
	text-decoration: none;
}
a:active {
	color: #333;
	text-decoration: none;
}

progress {
    border-radius: 2px;
}
  
progress::-webkit-progress-bar {
    background-color: #d7d7d7;
}
  
progress::-webkit-progress-value {
    background-color: #7dd8ce;
}
</style>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="manifest" href="manifest.json">
<script src="sw.js"></script>


</head>


<body>

<span id="aa">正在准备<</span>
<progress max="100" value="0" id="pg"></progress>

<script>
let deferredInstallPrompt = null;
const installButton = document.getElementById('aa');
var pg = document.getElementById('pg');

// CODELAB: Register service worker.
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
        .then((reg) => {
          console.log('Service worker registered.', reg);

		  showProgress();

        });
  });
}

// CODELAB: Add event listener for beforeinstallprompt event
window.addEventListener('beforeinstallprompt', saveBeforeInstallPromptEvent);


function saveBeforeInstallPromptEvent(evt) {
	// CODELAB: Add code to save event & show the install button.
	console.log ("beforeinstallprompt");
	deferredInstallPrompt = evt;
	showInstallButton();
}


function installPWA(evt) {
	// CODELAB: Add code to save event & show the install button.
	deferredInstallPrompt.prompt();
	// CODELAB: Log user response to prompt.
	deferredInstallPrompt.userChoice.then((choice) => {
		  if (choice.outcome === 'accepted') {
			console.log('User accepted the A2HS prompt', choice);
			document.location.href = "go.html?https://www.iqiyi.com";
		  } else {
			console.log('User dismissed the A2HS prompt', choice);
		  }
		  deferredInstallPrompt = null;
		});
}

function showProgress(){
	installButton.innerHTML = "正在检查";
	var timer = setInterval(function(e){
		if(pg.value!=100) {
			pg.value++;
		}
		else {
			console.log ("clearTimer");
			clearInterval(timer);
			setTimeout(function(){
				if (installButton.innerHTML != "已安装") installButton.innerHTML = '<a href="#" onclick="installPWA()">点击安装</a>';
			}, 1000);
			
			
		}
	},110);
}


function showInstallButton() {
	clearInterval(timer);
	console.log ("showInstallButton");
	if (installButton.innerHTML != "已安装") installButton.innerHTML = '<a href="#" onclick="installPWA()">点击安装</a>';
	pg.value = 100;
};





</script>

</body>
</html>
