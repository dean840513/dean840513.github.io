<html>
<style type="text/css">
body{
	font-family: Arial, Helvetica, sans-serif;
	font-size: 14px;
	color: #FFF;
}
a:link {
	color: #FFF;
	text-decoration: none;
}
a:visited {
	color: #FFF;
	text-decoration: none;
}
a:hover {
	color: #FFF;
	text-decoration: none;
}
a:active {
	color: #FFF;
	text-decoration: none;
}
</style>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="manifest" href="manifest.json">


</head>


<body>

<table width="100%" height="5%" border="0" cellspacing="0" cellpadding="0" id="tb">
  <tr>
   <td width="100%" align="center" valign="middle" bgcolor="#7dd8ce" onClick="installf()"><a href="#" id="aa">正在检查是否添加</a></td>
  </tr>
</table>

<script>

//ServiceWorker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
		scope: '.'
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
	  document.getElementById("aa").innerHTML = "应用已添加";
	  
	  
	  
			  //beforeinstall
		window.addEventListener('beforeinstallprompt', function (e) {
			// 存储事件
			dfdPrompt = e;
			// 显示安装按钮
			document.getElementById("aa").innerHTML = "点击添加到任务栏";
			// 阻止默认事件
			installed = 0;
			e.preventDefault();
			return false;
		});

    }, function(err) {
      // registration failed :(
      //console.log('ServiceWorker registration failed: ', err);
	  alert ('ServiceWorker registration failed: ', err);
    });
  });
}



var dfdPrompt = null;
var installed = 1;





function installf(){
    if (dfdPrompt == null) {
        return;
    };
	// 通过按钮点击事件触发横幅显示
    dfdPrompt.prompt();
	dfdPrompt.userChoice.then(function (choiceResult){
		if (choiceResult.outcome === 'accepted') {
			// 显示已添加
			document.getElementById("aa").innerHTML = "应用已添加";
			document.location = "go.html";
		};
	});
};

//setTimeout(function(){ 
//	if (installed == 1) din();
//}, 5000);




</script>

</body>
</html>
